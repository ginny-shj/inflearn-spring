# 1. 프로젝트 환경설정

### 프로젝트 생성

- spring boot 환경설정 : start.spring.io
- main 함수 실행하면, 
@SpringBootApplication : 스프링부트 앱을 실행 (tomcat웹서버 내장 → run 하면 실행하면서 웹서버 활성화)
localhost:8080 쳐보기
- 설정 preference : gradle이 아니라, intellij로 해야 좀더 빠름
- **빌드를 위한 버전 정리** 
start.spring.io가 아니라, new project에서 가져옴
    - [gradle-wrapper.properties](http://gradle-wrapper.properties) > gradle-6.7.1-bin.zip
    (8버전은 intelliJ에서 지원 안함)
    - build.gradle.kts > plugins > springframework.boot version 2.4.2
    (gradle에 맞는 springboot버전)
    - java version 8로 했음 (11도 되나 확인)

### 라이브러리

- 라이브러리 몇개 없음 : 하지만 사실 gradle이 일을 다 하고 있었던 것
- logging 라이브러리 : pirntln 하면 안됨!! log로 남겨야 심각한 에러만 관리할 수 있음 
springboot logging → logback, slf 두 라이브러리를 많이 씀
- test 라이브러리 : 자바(JUnit 5버전) assertj, ...
spring-test : 스프링과 통합해서 테스트해주는 라이브러리

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/c0b78dfa-f531-4107-9fc9-9072ea063dfc/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/c0b78dfa-f531-4107-9fc9-9072ea063dfc/Untitled.png)

### View 환경설정

- welcome 페이지 만들기 
resources/static/index.html 에 만들면, welcome페이지로 만들어줌
spring,io > reference 찾으면 다 나와있음! 메뉴얼에서 검색할 줄 알아야 (resources디렉토리에서 index.html을 먼저 찾는다)
- static : 정적 파일 = 루프도 없고 코딩이 아닌 것
- thymeleaf : 템플릿 엔진 종류 → 동적으로 바꿀 수 있음 (thymelaef.org)

### 빌드하고 실행 (Terminal)

1. ./gradlew build 
쉘스크립트 명령어 써있음  -  build 시작
2. build/libs 에 jar 파일 생긴 것을 볼 수 있음
3. java -jar 파일명.jar   ⇒  실행가능한 jar파일

# 2. 스프링 웹개발 기초

### 정적 컨텐츠

- 서버에서 하는게 없이 파일을 그대로 웹브라우저에 내려주는 것 (index.html처럼)
- 하는 방법 : 
>> intelliJ에서 resorces > static > file.html 넣기 
>> 웹브라우저에서 [localhost:8080/file.html](http://localhost:8080/file.html)
- 돌아가는 방식 )
    1. 웹브라우저 localhost:8080/file.html
    2. controller우선순위 : file 관련 controller를 스프링 컨테이너에서 찾는다
    3. 그다음 우선순위인 static/file.html을 찾는다

**정적컨텐츠가 아니라면, 이걸 html로 내리느냐 = mvc, 데이터로 바로 내리느냐 =  api**

### MVC와 템플릿 엔진

- html을 서버에서 프로그램한 뒤, 동적으로 바꿔서 내려주는 것 (controller, view, ...)
- MVC 방식 
1. controller : 서버와 비즈니스 로직
2. view  : 화면 출력
- 실습 java-spring 파일 : 새로운 컨트롤러와 뷰 만들기
- 돌아가는 방식 )
1. 웹브라우저 localhost:8080/hello-mvc
2. 스프링 컨테이너에서 @Getmapping (hello-mvc) 찾음
3. return hello-template, model(name:hi) : model을 통해 key value값을 줌
4. 스프링 컨테이너에서 viewResolver : templates/hello-template.html파일을 찾는다
5. html변환 후, 웹브라우저에 줌

### API

- 클라이언트(아이폰, 갤럭시 등)
- xml등이 아니라, json  dataformat으로 데이터를 내려주는 것
- 방식1 : view, react, 등을 쓸 때도 api로 데이터를 주면, 화면을 클라이엍느가 내림
- 방식2 : 서버끼리 통신 - html필요가 없고, 데이터만 흐르면 되기 때문에
- View 가 필요가 없다!
- 돌아가는 방식 )
1. 웹브라우저 localhost:8080/hello-api
2. 스프링 컨테이너에서 @Getmapping (hello-api) 찾음
3. return hello(name:me) : @ResponseBody 를 통해 key value값을 줌
4. 스프링 컨테이너에서 HttpMessageConverter : json변환기, 또는 String 변환기를 통해 key, value 값을 보냄
5. {key : value} json형식으로 웹브라우저에 직접 줌

# 3. 백앤드 개발 - 회원관리 예제

### 비즈니스 요구사항 정리

가장 단순한거로!

- 데이터 (**리포지토리, 도메인**): 회원id, 이름
- 기능 (**서비스**) : 회원가입, 조회
- DB 미정이라는 시나리오 : interface로 리포지토리 설계

웹어플리케이션 계층구조

- 컨트롤러 → 서비스 → 리포지토리 → DB  + (도메인)
    - **도메인** : 비즈니스 도메인 객체 (회원 등을 DB에 저장하고 관리)
    - **서비스** : 핵심 비즈니스 로직 (회원가입, 조회)
    - **리포지토리** : DB접근, 도메인 객체를 DB에 저장및관리

클래스 의존관계

- MemeberService ⇒ MemberRepository (interface) ←MemoryMemberRepository

### 회원 domain, repository, service 만들기 및 테스트

- domain > Member 데이터클래스
- repository > MemberRepository & test만들기
- service > 
(repository를 중심으로 비즈니스 로직 구현)

# 4. 스프링 빈과 의존관계

스프링 빈 등록!

### 컴포넌트 스캔과 자동 의존관계 설정

어노테이션을 찾아서, 자동으로 컴포넌트 스캔과 의존관계 설정해줌

1. @Controller, @Service, @Repository : 컨테이너 등록
2. @Autowired : 화살표 등록 (의존관계 설정)

- **memberService를 인스턴스 여러개 둘 필요가 없음** 
따라서, 스프링 컨터이너에 등록을 하고 쓰기 → 인스턴스 만들지 말고, 생성자로 + @Autowired + 자바클래스에 @Service, @Repository
- 실행 기준 : main 함수의 package 
package me.shj.javaspring; 
여기 파일에서만 Component 스캔함
- 스프링 빈을 등록할 때, 기본은 모두 싱글톤이다 = 인스턴스로 유일하다

### 자바코드로 직접 스프링 빈 등록하기

Config파일에서 @Bean으로 설정

- 원래는 자바코드가 아니라, xml파일로 설정했었음
- Dependency Injection의 3가지 방법
    1. 생성자 호출하면서 ⇒ 지금의 방법
    2. 필드 주입 : 생성자 쓰지 않고, @Autowired private MemberService memberSerivce;
    하지만 별로 좋지 않은 방법 
    3. 세터 주입 : 세터와 생성을 통한 주입 
    단점 : public이기 때문에 노출되어서 위험이 있음 

<두가지 방법 중에 무엇을 선택하나?>

- 정형화된 상황 = 컴포넌트 스캔
- 비정형화된 상황, 상황에 따라 구현 클래스를 변경해야하는 상황 = 자바 코드로 직접 설정
나중에 우리가 Repository를 바꿀 것이기 때문에 자바코드로 할 것임! = 다른 코드를 전혀 손 볼 필요가 없이 가볍게 바꿔치기 할 수 있음

# 5. 웹 MVC 개발

: 회원관리 예제

MemberController 활용

실습

- 홈화면 추가 : HomeController
- 등록 : MemberController, MembrerForm
    - get : url 엔터, 조회할 때
    - post : 정보를 입력해서 전달할 때
- 조회 : MemberController (Model 이용)

# 6. 스프링 DB 접근 기술

### H2 DB 설치

- DB : 오라클, MySQL - h2DB
- db 접근 :  [localhost/~/test](http://localhost/~/test) (/~/test가 아니라!) → 토켓을 통해 접근하기 때문에, 오류가 안남

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/f922ca42-ccbe-4f6c-8465-73b4419d9848/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/f922ca42-ccbe-4f6c-8465-73b4419d9848/Untitled.png)

```sql
//table 만들기

create table member
(
id bigint generated by default as identity, //id : Long->BigInt타입, 그 이후~~ : null 값ㅇ르 db가 자동으로 채워줌
name varchar(255),
primary key (id)

);

//만든 member table 조회
select * from member;

//table 에 insert
insert into member(name) values('spring')

//table 내용 제거
delete from member;
```

- db파일을 intelliJ에 관리함 (패키지 만들기) → ddl.sql 파일 만들어서 관리 (git과 같이 소스코드 관리가 됨)

### 1. 순수 JDBC

- 톰켓서버와 db연결하는 기술
- db에 쿼리를 넣어서 (20년전의 방법을 통해) 넣고, 빼기 → 옛날기술이라 어려움
- 설정하는 법
    1. build.gradle 에서 dependency 추가 (라이브러리 추가)
        1. implementation : ~~jdbc 
            - 자바는 기본적으로 cb랑 붙으려면 jdbc 드라이버가 꼭 필요
        2. runtimeOnly ~~~ 
            - db를 제공하는 클라이언트
    2. recources > [application.properties](http://application.properties) (접속정보 넣기)
    3. java > repository : JdbcMemberRepository 자바파일
        - db를 연동할거야! 라는말이 필요 ( 상속해서 하나씩 매소드를 구현하면 됨)
    4. SpringConfig 에서 @Bean 등록 + @Autowired 에서 Datasource 연결
        - **객체지향(다형성)과 의존성주입이 매우 유리한 이유**
        - 기존의 코드를 전혀 손대지 않고, 나머지 코드는 하나도 손대지 않아도 됨
        - 개방-폐쇄 원칙 (OCP)

### 스프링 통합 테스트

하지만 먼저, java 순수 테스트를 잘 만드는 것이  더 중요!!

- test까지도 db까지 연결해서 할 수 있는 기술
    - 원래꺼는 순수한 java 문으로 되어 있는데, 이것을 db와 연결해서 할 수 있는게 필요
- 하는 법
    - MemberServiceIntegrationTest 만들어서 복붙
    - @SpringBootTest, @Transactional 추가
    - @autowired 추가
- @Transacional : commit 안하면 db 에 반영이 되지 않는데, test끝나면 rollback을 하기 때문에 저장이 안됨. 따라서, test용 db를 관리하는 것? 반영을 하지 않는 것 = 다음 test를 또 반복할 수 있다.

### 2. 스프링 Jdbc Template - 실무

- 순수 JCBC가 어려워서 스프링이 sql을 편리하게 날릴 수 있도록 도와주는것
- dependency 설정 : starter-jdbc 추가하면 됨
- JDBC API에서 반복코드를 대부분 제거해준다 (단, sql은 직접 작성해야 함)
- 디자인 패턴 중에, 템플릿 매서드 패턴을 이용한 template
- JDBC template manual 로 검색하면 자세히 나옴

### 3. JPA     (vs 마이바티스)

- 깊이가 있어서 스프링처럼 따로 공부도 해야함
- sql 조차도 직접 하는것도 아니고 객체를 cb에 쿼리없이 저장할 수 있음
- 쿼리까지 다 없앨 수 있다 → 개발 생산성까지 높여줌
- sql중심의 설계보다는 객체 중심의 설계로 패러다임을 전환할 수 있다.
- jpa 인터페이스 → 구현체 중에 hibernate(업체)를 주로 쓸 거임
- 객체, ORM(객체, 관계형데이터, 매핑) 기술
- 이미 해외, 은행에서 쓰고, 큰 프로젝트에도 잘 씀
- 설정
    - 라이브러리 추가 (dependency - spring-starter-data-jpa)
    - [application.properties](http://application.properties) 추가 (sql, table)
    - Member.java : jpa가 관리하는 Entity다, 식별자pk(id, name)- identity전략 = db가 알아서 id생성해주는 것
    - Repository 생성 → EntityManager를 사용
    - Service 측에, @Transactional이 있어야 함
    - SpringConfig 파일 :

### 4. 스프링 데이터 JPA

- JPA 를 편리하게 쓸 수 있도록 한 것
- 인터페이스 만으로 개발이 가능해지고, 반복개발코드가 확 줄어듦
- jpa 를 먼저 학습한 뒤에, 스프링데이터Jpa를 공부하는 것이 좋다. (스프링데이터 Jpa는 jpa를 편리하게 해주는 거기때문에, 기본을 갖춰야)
- findByName, findByEnail() 처럼 매서드 이름으로 조회 기능 제공 (인터페이스 건너서 찾아보기)
- 동적 쿼리를 우너한다면, Querydsl 라이브러리 사용, 또는 jdbcTemplate도 같이 쓸 수 있다.

# 7. AOP

### AOP가 필요한 상황

- 상황

    모든 매소드의 호출 시간을 측정하고 싶을 때 (원래는 코드끝마다 노가다를, 초단위 → 밀리세컨 등 수정하고 싶을 때 하나하나)

    - 시간을 측정하는 것은 공통의 로직 o, 핵심관심사항x
    - try, finally, 시간빼기 등의 코드는 유지보수가 어려움..
    - 공통관심사항 cross-cutting concern, 핵심관심사항 core concern

### AOP 적용

- 공통관심사항과 핵심관심사항의 분리
- 시간측정로직을 하나 만들고, 나머지에 빈에 다 적용하면 됨
- 만들기 :
    - 패키지 aop > TimeTraceAop.java
    - spring bean 등록
- 원리 : 가짜 프록시를 만들어서, joinPoint.proceed() 실행
자세한 것은 나중에
